<svg xmlns="http://www.w3.org/2000/svg" width="182.1mm" height="225.6mm" version="1.1" viewBox="0 0 182.1 225.603"><defs><filter id="a" width="1.125" height="1.099" x="-.063" y="-.049" color-interpolation-filters="sRGB"><feGaussianBlur stdDeviation="15.408"/></filter></defs><g transform="translate(807.32 618)"><rect width="590.55" height="749.3" x="2395" y="743.62" fill-opacity=".996" filter="url(#a)" transform="matrix(.27404 0 0 .27404 -1453.5 -811.64)"/><rect width="161.83" height="205.34" x="-799.8" y="-610.76" fill="#fff" fill-opacity=".996"/><g><rect width="1.435" height="24.758" x="-460.09" y="677.79" transform="rotate(90)"/><rect width="1.435" height="21.272" x="-493.87" y="731.55" transform="rotate(90)"/><text x="-739.812" y="-495.098" fill="#000" stroke-width=".073" dominant-baseline="auto" font-family="'Open Sans'" font-size="3.094" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-739.812" y="-495.098" stroke-width=".073">Yes</tspan></text></g><path fill="#fff" stroke="#000" stroke-width="1.206" d="m-777.65-577.12h23.075c3.3599 0.0747 5.5257 3.5038 5.4557 5.6978-0.07 2.1941-1.697 5.9145-5.3018 6.0545-5.0352-0.0509-18.547 0.0709-23.582 0.0206-2.2582-0.0882-4.5671-3.0397-4.5533-6.2647 0.014-3.225 2.6009-5.4327 4.9065-5.5082z"/><g><rect width="1.435" height="26.25" x="-712.54" y="-522.48"/><rect width="1.435" height="76.231" x="-527.97" y="677.63" transform="rotate(90)"/><rect width="1.435" height="100.28" x="-766.07" y="-565.39"/></g><g fill="#000" font-family="'Open Sans'" letter-spacing="0" text-anchor="middle" word-spacing="0"><text x="-765.053" y="-452.657" stroke-width=".304" dominant-baseline="auto" font-size="4.864" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-765.053" y="-452.657">http</tspan><tspan x="-765.053" y="-446.577">processing</tspan></text><text x="-766.811" y="-569.768" stroke-width=".304" dominant-baseline="auto" font-size="4.864" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-766.811" y="-569.768" stroke-width=".304">Connection</tspan></text><text x="-660.091" y="-531.229" stroke-width=".073" dominant-baseline="auto" font-size="4.64" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-660.091" y="-531.229">Issue http</tspan><tspan x="-660.091" y="-525.428">redirect to</tspan><tspan x="-660.091" y="-519.628">https://</tspan></text></g><path stroke="#000" stroke-width=".073" d="m-759.71-465.99h-11.894l6.2548 6.2548z"/><g><path fill="#fff" stroke="#000" stroke-width="1.096" d="m-765.43-540.28-21.47 12.396 22.038 12.723 20.338-11.742z"/><text x="-764.46" y="-528.615" fill="#000" stroke-width=".213" dominant-baseline="auto" font-family="'Open Sans'" font-size="3.409" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-764.46" y="-528.615">TLS header</tspan><tspan x="-764.46" y="-524.353">looks bad?</tspan></text><path fill="#fff" stroke="#000" stroke-width="1.096" d="m-712.26-539.4-21.47 12.396 22.038 12.723 20.748-12.767z"/><text x="-712.215" y="-529.109" fill="#000" stroke-width=".213" dominant-baseline="auto" font-family="'Open Sans'" font-size="3.409" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-712.215" y="-529.109">Redirect http</tspan><tspan x="-712.215" y="-524.848">to https enabled?</tspan></text></g><path stroke="#000" stroke-width=".073" d="m-678.95-533.2v11.894l6.2549-6.2548z"/><g><text x="-739.983" y="-528.757" fill="#000" stroke-width=".073" dominant-baseline="auto" font-family="'Open Sans'" font-size="3.094" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-739.983" y="-528.757" stroke-width=".073">Yes</tspan></text><text x="-688.214" y="-529.192" fill="#000" stroke-width=".073" dominant-baseline="auto" font-family="'Open Sans'" font-size="3.094" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-688.214" y="-529.192" stroke-width=".073">Yes</tspan></text><rect width="1.435" height="26.25" x="-712.26" y="-488.52"/></g><path fill="#fff" stroke="#000" stroke-width="1.096" d="m-711.97-505.44-21.47 12.396 22.038 12.723 20.748-12.767z"/><g><text x="-711.932" y="-495.149" fill="#000" stroke-width=".213" dominant-baseline="auto" font-family="'Open Sans'" font-size="3.409" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-711.932" y="-495.149">Allow http</tspan><tspan x="-711.932" y="-490.888">on https enabled?</tspan></text><rect width="1.507" height="18.707" x="-879.04" y="193.74" transform="rotate(45.692)"/><rect width="1.435" height="26.25" x="-712.38" y="-454.93"/></g><g stroke="#000"><path fill="#fff" stroke-width="1.096" d="m-712.09-471.85-21.47 12.396 22.038 12.723 20.748-12.767z"/><path stroke-width=".073" d="m-678.88-465.36v11.894l6.2548-6.2548z"/><path fill="#fff" stroke-width="1.206" d="m-723.2-429.07h23.075c3.36 0.0746 5.5257 3.5038 5.4558 5.6978-0.07 2.194-1.697 5.9145-5.3019 6.0545-5.0352-0.0508-18.547 0.0709-23.582 0.0205-2.2582-0.0882-4.5671-3.0397-4.5533-6.2647 0.014-3.225 2.6009-5.4327 4.9065-5.5082z"/></g><g fill="#000" font-family="'Open Sans'" letter-spacing="0" text-anchor="middle" word-spacing="0"><text x="-712.497" y="-421.425" stroke-width=".304" dominant-baseline="auto" font-size="4.864" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-712.497" y="-421.425" stroke-width=".304">Error</tspan></text><text x="-688.837" y="-461.83" stroke-width=".073" dominant-baseline="auto" font-size="3.094" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-688.837" y="-461.83" stroke-width=".073">Yes</tspan></text><text x="-711.282" y="-462.362" stroke-width=".213" dominant-baseline="auto" font-size="3.409" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-711.282" y="-462.362">Fallback</tspan><tspan x="-711.282" y="-458.1">set and enabled</tspan><tspan x="-711.282" y="-453.839">on vhost?</tspan></text></g><g fill="#00f" stroke-width=".012" font-family="'Open Sans'" font-size="2.376" letter-spacing="0" text-anchor="middle" word-spacing="0"><text x="-688.363" y="-538.933" dominant-baseline="auto" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-688.363" y="-538.933">LWS_SERVER_OPTION_REDIRECT_</tspan><tspan x="-688.363" y="-535.963">HTTP_TO_HTTPS</tspan></text><text x="-686.297" y="-504.248" dominant-baseline="auto" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-686.297" y="-504.248">LWS_SERVER_OPTION_ALLOW_</tspan><tspan x="-686.297" y="-501.278">HTTP_ON_HTTPS_LISTENER</tspan></text><text x="-683.631" y="-471.231" dominant-baseline="auto" text-align="center" xml:space="preserve" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal"><tspan x="-683.631" y="-471.231">LWS_SERVER_OPTION_FALLBACK_TO_</tspan><tspan x="-683.631" y="-468.261">APPLY_LISTEN_ACCEPT_CONFIG</tspan></text></g><g><text x="-661.865" y="-462.394" fill="#000" stroke-width=".105" dominant-baseline="auto" font-family="'Open Sans'" font-size="4.64" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-661.865" y="-462.394">Fallback</tspan><tspan x="-661.865" y="-456.594">role +</tspan><tspan x="-661.865" y="-450.793">protocol</tspan></text><text x="-721.378" y="-592.375" fill="#000" stroke-width=".073" dominant-baseline="auto" font-family="'Open Sans'" font-size="13.921" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-721.378" y="-592.375" stroke-width=".073">TLS port</tspan></text><path fill="red" d="m-732.59-572.25c1.9501-3.293 3.8701-6.6043 5.8395-9.8856 0.2398-0.54978 0.8982-0.73811 1.3074-0.10105 0.3564 0.71254 0.6543 1.2038 0.9662 1.8124 1.5622 2.7051 3.1244 5.4102 4.6866 8.1153 0.2615 0.57459 0.21211 1.1772-0.3115 1.4642-0.6618 0.10273-1.0635 0.0238-1.6072 0.0453-3.3542-0.0106-6.7089 0.0256-10.063 0.0135-0.5994 0.042-1.205-0.57336-0.9833-1.1331 0.055-0.11036 0.1104-0.22074 0.1656-0.33109z"/><path fill="#fff" d="m-731.04-572.98c1.4834-2.5049 2.9439-5.0238 4.442-7.5197 0.1824-0.4182 0.6833-0.56147 0.99461-0.0769 0.2711 0.54201 0.4977 0.91573 0.73489 1.3787 1.1883 2.0577 2.3767 4.1154 3.565 6.1731 0.1989 0.43707 0.16139 0.89545-0.2369 1.1138-0.50351 0.0781-0.80901 0.0181-1.2226 0.0344-2.5514-8e-3 -5.1034 0.0195-7.6549 0.0103-0.45599 0.0319-0.9167-0.43614-0.74809-0.86194 0.042-0.084 0.084-0.16791 0.126-0.25185z"/><path d="m-726.75-575.05c-0.1016-1.1244-0.2033-2.2489-0.30501-3.3733 0-0.53089 0.5276-0.97852 1.0501-0.80555 0.5428 0.0382 0.767 0.6127 0.65131 1.0873-0.19201 1.0861-0.28691 2.1887-0.51801 3.2682-0.1473 0.45794-0.8791 0.39062-0.86-0.12607l-0.019-0.0506z"/><circle cx="-726.3" cy="-573.3" r=".696"/><text x="-696.928" y="-579.725" fill="#000" stroke-width=".103" dominant-baseline="auto" font-family="'Open Sans'" font-size="3.016" style="font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;line-height:1.25;shape-padding:0;text-decoration-color:#000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal" letter-spacing="0" text-align="center" text-anchor="middle" word-spacing="0" xml:space="preserve"><tspan x="-696.928" y="-579.725">This flow happens</tspan><tspan x="-696.928" y="-575.955">before any vhost selection</tspan><tspan x="-696.928" y="-572.184">using SNI or Host: headers.</tspan><tspan x="-696.928" y="-568.414">Therefore it occurs on the</tspan><tspan x="-696.928" y="-564.644" font-weight="bold">first vhost that listens</tspan><tspan x="-696.928" y="-560.874"><tspan stroke-width=".103" font-weight="bold">on the connection port</tspan>.</tspan></text></g></g></svg>